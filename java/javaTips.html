<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>javaTips</title>
<link rel="stylesheet" type="text/css" href="../template/style/main.css" />
<link type="text/css" rel="stylesheet" href="../template/style/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../template/style/shCoreRDark.css"/>
<script type="text/javascript" src="../template/js/jquery.js"></script>
<!--For code highlighting-->
<script type="text/javascript" src="../template/js/shCore.js"></script>
<script type="text/javascript" src="../template/js/shBrushPlain.js"></script>
<script type="text/javascript" src="../template/js/shBrushVim.js"></script>
<script type="text/javascript" src="../template/js/shBrushBash.js"></script>
<script type="text/javascript" src="../template/js/shBrushCss.js"></script>
<script type="text/javascript" src="../template/js/shBrushJava.js"></script>
<script type="text/javascript" src="../template/js/shBrushJScript.js"></script>
<script type="text/javascript" src="../template/js/shBrushPython.js"></script>
<script type="text/javascript" src="../template/js/shBrushSql.js"></script>
<script type="text/javascript" src="../template/js/shBrushXml.js"></script>

<script type="text/javascript">
$(document).ready(function() {
		SyntaxHighlighter.all();
		if (window.innerWidth >= 460) {
		var toggler = $('<div class="toggler" title="Toggle Table Of Content">Table Of Content</div>');
		toc = $('.toc');
		toc.wrap('<div class="tocWrap">');

		$('.tocWrap').prepend(toggler)
		.delay(500)
		.fadeTo(500, '0.7')
		.hover(function() {
			$(this).stop().fadeTo(300, '0.9');
			}, function() {
			$(this).stop().fadeTo(300, '0.7');
			});

		$('html').keypress(function(e) {
			if (e.shiftKey && (e.charCode || e.keyCode) == '90') {
			e.preventDefault();
			$('div.tocWrap').toggle(200);
			}
			});

		toggler.click(function() {
				$('div.toc').slideToggle(300);
				});
		}

		$("a,h1,h2,h3,h4,h5,h6").filter(function(index){
			return $(this).text()=='!Important!';
				}).addClass("importantMarker");

		

});



</script>
</head>
<body >
<header id="header">
<div id="logo" style="font-size: 22pt;text-align:center;"><a href="#">Kent's Wiki</a></div>
</header>
<div id="wrap">
<div id="content">

<div class="toc">
<ul>
<li><a href="#toc_0.1">Pitfalls</a>
<ul>
<li><a href="#toc_0.1.1">check even/odd</a>
<li><a href="#toc_0.1.2">silent number overflow</a>
<li><a href="#toc_0.1.3">double/float tips</a>
<ul>
<li><a href="#toc_0.1.3.1">represent infinity:</a>
<li><a href="#toc_0.1.3.2">large float/double</a>
</ul>
</ul>
<li><a href="#toc_0.2">Strings</a>
<ul>
<li><a href="#toc_0.2.1">Matcher.quoteReplacement(string)</a>
<li><a href="#toc_0.2.2">Build repeated string</a>
</ul>
<li><a href="#toc_0.3">Initialization Procedure</a>
<li><a href="#toc_0.4">Comparable/Comparator</a>
<li><a href="#toc_0.5">Performance</a>
</ul>
</ul>
</div>

<h2 id="toc_0.1">Pitfalls</h2>

<h3 id="toc_0.1.1">check even/odd</h3>
<p>
 Do <strong>NOT</strong> use <code>if (i % 2 == 1)</code>  it won't work for negative numbers. Use
</p>
<pre class="brush: java">
	if (i % 2 != 0)
//or even better with bitwise AND operator
	if ((i &amp; 1) !=0)
</pre>

<h3 id="toc_0.1.2">silent number overflow</h3>
<p>
<code>final long NUM=24 * 60 * 60 * 1000 * 1000;</code> will overflow, since java will automatically think all constants are int, and result is int even if declared as <code>long</code>
Solution is <code>final long NUM=24L * 60 * 60 * 1000 * 1000;</code> (<strong>better with big L</strong>)
</p>

<h3 id="toc_0.1.3">double/float tips</h3>
<p>
1. it is possible to represent infinity as a double or a float.
2. adding a small floating-point value to a large one will not change the large value
3. binary floating-point arithmetic is only an approximation to real arithmetic.
4. (from puzzle 28)
</p>

<h4 id="toc_0.1.3.1">represent infinity:</h4>

<pre class="brush: java">
double i = 1.0 /0.0;
double i = Double.POSITIVE_INFINITY;
</pre>

<h4 id="toc_0.1.3.2">large float/double</h4>

<p>
Floating-point operations return the floating-point value that is closest to their exact mathematical result. Once the distance between adjacent floating-point values is greater than 2, adding 1 to a floating-point value will have no effect, because the half-way point between values won’t be reached. For the float type, the least magnitude beyond which adding 1 will have no effect is 2^25 , or 33,554,432; for the double type, it is <code>2^54</code> , or approximately <code>1.8 × 10^16</code> .
</p>

<p>
The distance between adjacent floating-point values is called an ulp, which is an acronym for unit in the last place. In release 5.0, the Math.ulp method was introduced to calculate the ulp of a float or double value.
</p>

<h2 id="toc_0.2">Strings</h2>
<h3 id="toc_0.2.1">Matcher.quoteReplacement(string)</h3>
<p>
<code>$ or \</code> in replacement part of <code>replaceAll()</code> has special meaning. With <code>Mather.quoteReplacement(str)</code>, those chars will lost their special meanings.
</p>

<h3 id="toc_0.2.2">Build repeated string</h3>
<pre class="brush: java">
// repeat "foo" 100 times
String repeated = new String(new char[100]).replace("\0", "foo");
</pre>
  
<h2 id="toc_0.3">Initialization Procedure</h2>
<p>
see <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4.2">http://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4.2</a>
</p>
<ul>
<li>
reference static field only initialize the class which declared this field. e.g. Super delcared field "static a;" calling <code>SubclassOfSuper.a</code> will init<code> Super</code> , but not <code>SubclassOfSuper</code>

<li>
<code>final</code> field will be optimized by compiler as constant, reference final fields won't init the class.
<pre class="brush: text">
	6. Otherwise, record the fact that initialization of the Class object for C is in progress by the current thread, and release LC.
	Then, initialize the final class variables and fields of interfaces whose values are compile-time constant expressions
</pre>

</ul>
  
<h2 id="toc_0.4">Comparable/Comparator</h2>

<p>
the implmentation of <code>compareTo()</code> or <code>compare()</code> method must be consistent with <code>equals()</code>. 
</p>

<h2 id="toc_0.5">Performance</h2>

<ul>
<li>
To use TreeSet usually don't do <code>treeSet.add(..)</code>, but build a collection (<code>hashSet</code> for example), then convert it into TreeSet. Because TreeSet.add() is slower.

</ul>

<p>
<a href="../index.html">&lt;&lt;Back</a>
</p>

</div>
</div>
<div id="footer">
<a href="http://www.vim.org" target="_blank"><img border="0" src="../template/images/vimLogo.png" alt="Created with Vim" height="36" width="90"></a>
</div>
</body>
</html>
